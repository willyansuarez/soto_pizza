<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soto Pizza's: Tu Pizza a la Medida</title>
    <!-- Incluyendo Tailwind CSS para un estilo moderno y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Encabezado -->
    <header class="bg-orange-500 text-white p-4 text-center shadow-md">
        <h1 class="text-4xl font-bold font-['Pacifico'] tracking-wide">Soto Pizza's</h1>
        <p class="mt-1 text-sm">Crea tu pizza perfecta y pide ahora</p>
    </header>

    <!-- Contenido principal con nueva disposición responsive -->
    <main class="flex-grow container mx-auto p-4 md:p-8">
        <div class="main-content-flex flex flex-col-reverse lg:flex-row gap-8 items-start">
            <!-- Sección de menús: ingredientes, bebidas, postres. En mobile, esto irá debajo de la pizza. -->
            <div class="flex-1 w-full flex flex-col">
                <!-- Ingredientes de Pizza (siempre visibles) -->
                <div class="bg-white p-6 rounded-3xl shadow-lg border border-gray-200 mb-6">
                    <h2 class="text-2xl font-bold text-center mb-4 text-orange-600">Ingredientes Adicionales</h2>
                    <div id="ingredients-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                        <!-- Los ingredientes se generarán aquí con JavaScript -->
                    </div>
                </div>

                <!-- Contenedor de pestañas para otros productos -->
                <div class="flex justify-center flex-wrap mb-6 space-x-2 md:space-x-4">
                    <button id="drinks-tab" class="tab-btn px-4 md:px-6 py-3 rounded-full text-lg font-semibold transition-all duration-300 bg-orange-500 text-white shadow-lg">Bebidas</button>
                    <button id="desserts-tab" class="tab-btn px-4 md:px-6 py-3 rounded-full text-lg font-semibold transition-all duration-300 bg-white text-gray-700 hover:bg-orange-100">Postres</button>
                </div>
        
                <!-- Contenido de las pestañas -->
                <div id="tab-content">
                    <!-- Pestaña de Bebidas -->
                    <div id="drinks-panel" class="tab-panel bg-white p-6 rounded-3xl shadow-lg border border-gray-200">
                        <h2 class="text-2xl font-bold text-center mb-4 text-orange-600">Bebidas</h2>
                        <div id="drinks-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Las bebidas se generarán aquí con JavaScript -->
                        </div>
                    </div>
        
                    <!-- Pestaña de Postres -->
                    <div id="desserts-panel" class="tab-panel hidden bg-white p-6 rounded-3xl shadow-lg border border-gray-200">
                        <h2 class="text-2xl font-bold text-center mb-4 text-orange-600">Postres</h2>
                        <div id="desserts-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Los postres se generarán aquí con JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Área para montar la pizza. Ahora va primero en mobile para facilitar el arrastre. -->
            <div class="flex-1 w-full flex flex-col items-center lg:sticky lg:top-4">
                <h2 class="text-2xl font-bold mb-4 text-center text-orange-600">Haz clic para agregar o eliminar ingredientes</h2>
                <div class="w-full flex justify-center mb-3">
                    <button id="toggle-base-btn" class="px-4 py-2 rounded-full text-sm font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300">
                        Seleccionar Pizza Base (Bs. <span id="base-price-label">5.00</span>)
                    </button>
                </div>
                <div id="pizza-base-container" class="pizza-canvas aspect-square rounded-full shadow-xl overflow-hidden border-8 border-yellow-400">
                    <img id="pizza-base-image" src="https://placehold.co/600x600/FFD966/ffffff?text=Pizza+Base" alt="Base de Pizza" class="w-full h-full object-cover">
                    <!-- Los ingredientes se colocarán aquí -->
                </div>
            </div>
        </div>
    </main>

    <!-- Pie de página fijo con el total y el botón de pedido -->
    <footer class="fixed bottom-0 left-0 w-full bg-white p-2 shadow-lg flex justify-between items-center z-50">
        <div class="flex items-center text-xl font-bold">
            <span class="text-orange-600 mr-2">Total:</span>
            <span id="total-price">Bs. 0.00</span>
        </div>
        <button id="place-order-btn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">
            Hacer Pedido
        </button>
    </footer>

    <!-- Modal para la confirmación del pedido -->
    <dialog id="order-modal">
        <div class="text-center p-4">
            <h3 class="text-2xl font-bold mb-4 text-orange-600">Confirmar Pedido</h3>
            <div id="order-summary" class="mb-4 text-left p-4 bg-gray-100 rounded-lg">
                <h4 class="font-bold text-lg mb-2">Resumen:</h4>
                <ul id="summary-list" class="list-disc list-inside"></ul>
            </div>
            <div class="mb-4">
                <label for="customer-name" class="block text-gray-700 font-semibold mb-2">Tu Nombre:</label>
                <input type="text" id="customer-name" placeholder="Ingresa tu nombre" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                <p id="name-error" class="text-red-500 text-sm mt-1 hidden">Por favor, introduce tu nombre para continuar.</p>
            </div>
            <button id="confirm-order-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">
                Confirmar
            </button>
            <button id="cancel-order-btn" class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-full transition-colors">
                Cancelar
            </button>
        </div>
    </dialog>

    <!-- Modal de advertencia para pedidos vacíos -->
    <dialog id="warning-modal">
        <div class="text-center p-6 bg-yellow-100 rounded-lg shadow-inner">
            <h3 class="text-2xl font-bold mb-4 text-yellow-700">¡Advertencia!</h3>
            <p class="text-yellow-800 mb-6">Tu carrito está vacío. Por favor, añade algún producto antes de hacer el pedido.</p>
            <button id="close-warning-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-full transition-colors">Entendido</button>
        </div>
    </dialog>

    <!-- Modal para la confirmación final y captura de pantalla -->
    <dialog id="final-modal" class="bg-gray-100">
        <div id="final-modal-content" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 text-center flex flex-col items-center" style="min-width:320px; max-width:370px;">
            <h3 class="text-2xl font-bold mb-2 text-green-600">¡Pedido Enviado!</h3>
            <p class="text-gray-700 mb-4 font-semibold">Haz una captura de pantalla de la siguiente imagen y envíala por WhatsApp o Telegram.</p>
            <div id="summary-capture-container" class="bg-white p-6 rounded-lg shadow-inner border border-gray-300 w-full flex flex-col items-center" style="min-width:280px; max-width:340px;">
                <h4 class="font-bold text-xl text-green-700 mb-2">Pizzería El Sabor</h4>
                <pre id="final-summary-pre" class="text-left text-green-800 font-mono text-sm leading-relaxed overflow-auto mb-2" style="width:100%; padding-left:14px; padding-bottom:28px;">
                    <!-- Resumen del pedido en formato de ticket se insertará aquí -->
                </pre>
                <div class="w-full text-center mt-2 mb-1">
                    <span class="block text-green-700 font-semibold text-base">¡Gracias por tu compra!</span>
                </div>
            </div>
            <button id="close-final-btn" class="mt-4 bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-6 rounded-full">Cerrar</button>
            <button id="download-summary-btn" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full">Descargar imagen</button>
        </div>
    </dialog>

    <script>
        // Variables globales para rastrear el estado del pedido
        let totalPrice = 0;
        const basePizzaPrice = 5.00; 
        let baseSelected = false;
        let selectedToppings = [];
        let selectedDrinks = {};
        let selectedDesserts = {};

        // Definición de los productos
        const ingredients = [
            { id: 'pepperoni', name: 'Pepperoni', price: 1.50, image: 'https://placehold.co/80x80/E57373/ffffff?text=P' },
            { id: 'mushrooms', name: 'Champiñones', price: 1.00, image: 'https://placehold.co/80x80/66BB6A/ffffff?text=C' },
            { id: 'onions', name: 'Cebolla', price: 0.75, image: 'https://placehold.co/80x80/BA68C8/ffffff?text=O' },
            { id: 'olives', name: 'Aceitunas', price: 1.20, image: 'https://placehold.co/80x80/26A69A/ffffff?text=A' },
            { id: 'bell_peppers', name: 'Pimentón', price: 0.80, image: 'https://placehold.co/80x80/FBC02D/ffffff?text=P' },
            { id: 'extra_cheese', name: 'Queso Extra', price: 2.00, image: 'https://placehold.co/80x80/FFB74D/ffffff?text=Q' },
            { id: 'sausage', name: 'Salchicha', price: 1.80, image: 'https://placehold.co/80x80/795548/ffffff?text=S' },
            { id: 'pineapple', name: 'Piña', price: 1.00, image: 'https://placehold.co/80x80/FFEB3B/ffffff?text=P' },
            { id: 'chicken', name: 'Pollo', price: 2.50, image: 'https://placehold.co/80x80/E65100/ffffff?text=P' },
            { id: 'bacon', name: 'Tocino', price: 2.20, image: 'https://placehold.co/80x80/C62828/ffffff?text=T' }
        ];

        const drinks = [
            { id: 'coke', name: 'Coca Cola', price: 2.50, image: 'https://placehold.co/80x80/E53935/ffffff?text=C' },
            { id: 'sprite', name: 'Sprite', price: 2.50, image: 'https://placehold.co/80x80/8BC34A/ffffff?text=S' },
            { id: 'water', name: 'Agua', price: 1.00, image: 'https://placehold.co/80x80/4FC3F7/ffffff?text=A' },
            { id: 'iced_tea', name: 'Té Helado', price: 2.00, image: 'https://placehold.co/80x80/FF9800/ffffff?text=T' }
        ];

        const desserts = [
            { id: 'ice_cream', name: 'Helado', price: 3.50, image: 'https://placehold.co/80x80/E91E63/ffffff?text=H' },
            { id: 'brownie', name: 'Brownie', price: 4.00, image: 'https://placehold.co/80x80/5D4037/ffffff?text=B' },
            { id: 'cheesecake', name: 'Cheesecake', price: 5.00, image: 'https://placehold.co/80x80/FFECB3/ffffff?text=Q' }
        ];
        
        // Elementos del DOM
        const totalDisplay = document.getElementById('total-price');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabPanels = document.querySelectorAll('.tab-panel');
        const ingredientsList = document.getElementById('ingredients-list');
        const pizzaBaseContainer = document.getElementById('pizza-base-container');
        const toggleBaseBtn = document.getElementById('toggle-base-btn');
        const basePriceLabel = document.getElementById('base-price-label');
        const orderModal = document.getElementById('order-modal');
        const finalModal = document.getElementById('final-modal');
        const warningModal = document.getElementById('warning-modal');
        const placeOrderBtn = document.getElementById('place-order-btn');
        const confirmOrderBtn = document.getElementById('confirm-order-btn');
        const cancelOrderBtn = document.getElementById('cancel-order-btn');
        const closeWarningBtn = document.getElementById('close-warning-btn');
        const closeFinalBtn = document.getElementById('close-final-btn');
        const customerNameInput = document.getElementById('customer-name');
        const nameErrorElement = document.getElementById('name-error');
        const finalSummaryPre = document.getElementById('final-summary-pre');
        const drinksList = document.getElementById('drinks-list');
        const dessertsList = document.getElementById('desserts-list');

        // Función para resetear el estado de la aplicación
        function resetOrder() {
            selectedToppings = [];
            selectedDrinks = {};
            selectedDesserts = {};
            
            document.querySelectorAll('.pizza-topping').forEach(topping => {
                topping.remove();
            });
            
            document.querySelectorAll('[data-quantity-for]').forEach(span => {
                span.textContent = 0;
            });
            
            customerNameInput.value = '';
            updateTotal();
        }
        
        // Función para verificar si el pedido está vacío
        function isOrderEmpty() {
            const hasDrinks = Object.values(selectedDrinks).some(qty => qty > 0);
            const hasDesserts = Object.values(selectedDesserts).some(qty => qty > 0);
            return !baseSelected && selectedToppings.length === 0 && !hasDrinks && !hasDesserts;
        }

        // Función para actualizar el total
        function updateTotal() {
            totalPrice = 0; 
            
            if (baseSelected) {
                totalPrice += basePizzaPrice;
            }

            selectedToppings.forEach(topping => totalPrice += topping.price);
            
            for (const id in selectedDrinks) {
                const drink = drinks.find(d => d.id === id);
                totalPrice += drink.price * selectedDrinks[id];
            }
            
            for (const id in selectedDesserts) {
                const dessert = desserts.find(d => d.id === id);
                totalPrice += dessert.price * selectedDesserts[id];
            }
            
            totalDisplay.textContent = `Bs. ${totalPrice.toFixed(2)}`;
        }

        // Función para añadir el ingrediente a la pizza
        function addTopping(ingredient) {
            const toppingImg = document.createElement('img');
            toppingImg.src = ingredient.image;
            toppingImg.alt = ingredient.name;
            toppingImg.className = 'pizza-topping rounded-full';
            toppingImg.dataset.id = ingredient.id;

            const size = pizzaBaseContainer.getBoundingClientRect().width;
            const radius = size / 2;
            const toppingSize = 65; // Tamaño reducido
            let x, y, distance;
            
            do {
                x = Math.random() * (size - toppingSize);
                y = Math.random() * (size - toppingSize);
                
                const dx = (x + toppingSize / 2) - radius;
                const dy = (y + toppingSize / 2) - radius;
                distance = Math.sqrt(dx * dx + dy * dy);
                
            } while (distance + toppingSize / 2 > radius);

            toppingImg.style.left = `${x}px`;
            toppingImg.style.top = `${y}px`;

            pizzaBaseContainer.appendChild(toppingImg);
            selectedToppings.push(ingredient);
            updateTotal();

            setTimeout(() => {
                toppingImg.style.transform = 'scale(1)';
            }, 10);
        }

        // --- Generación de UI dinámica ---

        // Generar ingredientes para hacer clic
        ingredients.forEach(item => {
            const div = document.createElement('div');
            div.className = 'ingredient-item flex flex-col items-center p-2 bg-gray-50 rounded-lg shadow-sm cursor-pointer';
            div.dataset.id = item.id;
            div.innerHTML = `
                <img src="${item.image}" alt="${item.name}" class="w-16 h-16 rounded-full mb-1 border-2 border-orange-200 object-cover">
                <span class="text-sm font-medium text-center">${item.name}</span>
                <span class="text-xs text-gray-500">Bs. ${item.price.toFixed(2)}</span>
            `;
            ingredientsList.appendChild(div);
        });

        // Generar bebidas y postres con botones de + y -
        function generateItems(listElement, data, type) {
            listElement.innerHTML = '';
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex flex-col items-center bg-gray-50 p-4 rounded-xl shadow-md';
                div.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="w-24 h-24 rounded-full mb-3 border-2 border-orange-200 object-cover">
                    <h4 class="font-semibold text-lg text-center">${item.name}</h4>
                    <span class="text-md text-gray-700 mb-2">Bs. ${item.price.toFixed(2)}</span>
                    <div class="flex items-center space-x-2">
                        <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded-full" data-action="decrement" data-id="${item.id}" data-type="${type}">-</button>
                        <span data-quantity-for="${item.id}" class="w-8 text-center font-semibold">0</span>
                        <button class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-1 px-3 rounded-full" data-action="increment" data-id="${item.id}" data-type="${type}">+</button>
                    </div>
                `;
                listElement.appendChild(div);
            });
        }

        generateItems(drinksList, drinks, 'drink');
        generateItems(dessertsList, desserts, 'dessert');

        // --- Manejo de Eventos ---

        // Agregar ingrediente a la pizza al hacer clic
        ingredientsList.addEventListener('click', (e) => {
            const ingredientItem = e.target.closest('.ingredient-item');
            if (ingredientItem) {
                const ingredientId = ingredientItem.dataset.id;
                const ingredient = ingredients.find(item => item.id === ingredientId);
                if (ingredient) {
                    addTopping(ingredient);
                }
            }
        });

        // Toggle de pizza base
        function updateBaseButtonUI() {
            if (baseSelected) {
                toggleBaseBtn.classList.remove('bg-gray-200','text-gray-800');
                toggleBaseBtn.classList.add('bg-green-600','text-white');
                toggleBaseBtn.textContent = `Pizza Base seleccionada (Bs. ${basePizzaPrice.toFixed(2)})`;
            } else {
                toggleBaseBtn.classList.remove('bg-green-600','text-white');
                toggleBaseBtn.classList.add('bg-gray-200','text-gray-800');
                toggleBaseBtn.textContent = `Seleccionar Pizza Base (Bs. ${basePizzaPrice.toFixed(2)})`;
            }
        }

        toggleBaseBtn.addEventListener('click', () => {
            baseSelected = !baseSelected;
            updateBaseButtonUI();
            updateTotal();
        });

        // Eliminar ingrediente de la pizza al hacer clic sobre él
        pizzaBaseContainer.addEventListener('click', (e) => {
            const toppingImg = e.target.closest('.pizza-topping');
            if (toppingImg) {
                const toppingId = toppingImg.dataset.id;
                const indexToRemove = selectedToppings.findIndex(t => t.id === toppingId);
                
                if (indexToRemove !== -1) {
                    selectedToppings.splice(indexToRemove, 1);
                    toppingImg.remove();
                    updateTotal();
                }
            }
        });

        // Manejar clics en los botones de bebidas y postres
        document.getElementById('drinks-list').addEventListener('click', (e) => {
            const action = e.target.dataset.action;
            const itemId = e.target.dataset.id;
            if (action) {
                let quantity = selectedDrinks[itemId] || 0;
                if (action === 'increment') {
                    quantity++;
                } else if (action === 'decrement' && quantity > 0) {
                    quantity--;
                }
                selectedDrinks[itemId] = quantity;
                document.querySelector(`[data-quantity-for="${itemId}"]`).textContent = quantity;
                updateTotal();
            }
        });

        document.getElementById('desserts-list').addEventListener('click', (e) => {
            const action = e.target.dataset.action;
            const itemId = e.target.dataset.id;
            if (action) {
                let quantity = selectedDesserts[itemId] || 0;
                if (action === 'increment') {
                    quantity++;
                } else if (action === 'decrement' && quantity > 0) {
                    quantity--;
                }
                selectedDesserts[itemId] = quantity;
                document.querySelector(`[data-quantity-for="${itemId}"]`).textContent = quantity;
                updateTotal();
            }
        });
        
        // Manejar el cambio de pestañas
        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                tabButtons.forEach(b => {
                    b.classList.remove('active', 'bg-orange-600', 'text-white', 'shadow-lg');
                    b.classList.add('bg-white', 'text-gray-700', 'hover:bg-orange-100');
                });
                btn.classList.add('active', 'bg-orange-600', 'text-white', 'shadow-lg');
                btn.classList.remove('bg-white', 'text-gray-700', 'hover:bg-orange-100');

                tabPanels.forEach(panel => panel.classList.add('hidden'));
                const targetPanelId = btn.id.replace('-tab', '-panel');
                document.getElementById(targetPanelId).classList.remove('hidden');
            });
        });
        
        // Función para generar el resumen del pedido en formato de "ticket"
        function generateFinalSummary(customerName) {
            let summaryText = '--- PEDIDO DE PIZZERÍA EL SABOR ---\n\n';
            summaryText += `Nombre del cliente: ${customerName}\n\n`;
            summaryText += '--- Resumen del Pedido ---\n';

            if (baseSelected) {
                summaryText += `Pizza Base: Bs. ${basePizzaPrice.toFixed(2)}\n`;
            }
            if (selectedToppings.length > 0) {
                summaryText += 'Ingredientes Adicionales:\n';
                selectedToppings.forEach(topping => {
                    summaryText += `- ${topping.name} (Bs. ${topping.price.toFixed(2)})\n`;
                });
            }

            if (Object.keys(selectedDrinks).length > 0 && Object.values(selectedDrinks).some(qty => qty > 0)) {
                summaryText += '\nBebidas:\n';
                for (const id in selectedDrinks) {
                    const drink = drinks.find(d => d.id === id);
                    if (selectedDrinks[id] > 0) {
                        summaryText += `- ${drink.name} (x${selectedDrinks[id]}): Bs. ${(drink.price * selectedDrinks[id]).toFixed(2)}\n`;
                    }
                }
            }

            if (Object.keys(selectedDesserts).length > 0 && Object.values(selectedDesserts).some(qty => qty > 0)) {
                summaryText += '\nPostres:\n';
                for (const id in selectedDesserts) {
                    const dessert = desserts.find(d => d.id === id);
                    if (selectedDesserts[id] > 0) {
                        summaryText += `- ${dessert.name} (x${selectedDesserts[id]}): Bs. ${(dessert.price * selectedDesserts[id]).toFixed(2)}\n`;
                    }
                }
            }
            
            summaryText += '-----------------------------------\n';
            summaryText += `TOTAL A PAGAR: Bs. ${totalPrice.toFixed(2)}\n`;
            summaryText += '-----------------------------------\n';
            summaryText += '\n¡Gracias por tu compra!\n';

            finalSummaryPre.textContent = summaryText;
        }

        // Mostrar el modal de confirmación del pedido
        placeOrderBtn.addEventListener('click', () => {
            if (isOrderEmpty()) {
                warningModal.showModal();
                return;
            }

            const summaryList = document.getElementById('summary-list');
            summaryList.innerHTML = '';
            nameErrorElement.classList.add('hidden');

            if (baseSelected) {
                summaryList.innerHTML += `<li class="font-bold">Pizza Base: Bs. ${basePizzaPrice.toFixed(2)}</li>`;
            }
            if (selectedToppings.length > 0) {
                summaryList.innerHTML += `<li class="font-bold">Ingredientes:</li>`;
                selectedToppings.forEach(topping => {
                    summaryList.innerHTML += `<li>- ${topping.name} (Bs. ${topping.price.toFixed(2)})</li>`;
                });
            }

            if (Object.keys(selectedDrinks).length > 0 && Object.values(selectedDrinks).some(qty => qty > 0)) {
                summaryList.innerHTML += `<li class="font-bold">Bebidas:</li>`;
                for (const id in selectedDrinks) {
                    const drink = drinks.find(d => d.id === id);
                    if (selectedDrinks[id] > 0) {
                        summaryList.innerHTML += `<li>- ${drink.name} (x${selectedDrinks[id]}): Bs. ${(drink.price * selectedDrinks[id]).toFixed(2)}</li>`;
                    }
                }
            }

            if (Object.keys(selectedDesserts).length > 0 && Object.values(selectedDesserts).some(qty => qty > 0)) {
                summaryList.innerHTML += `<li class="font-bold">Postres:</li>`;
                for (const id in selectedDesserts) {
                    const dessert = desserts.find(d => d.id === id);
                    if (selectedDesserts[id] > 0) {
                        summaryList.innerHTML += `<li>- ${dessert.name} (x${selectedDesserts[id]}): Bs. ${(dessert.price * selectedDesserts[id]).toFixed(2)}</li>`;
                    }
                }
            }

            summaryList.innerHTML += `<li class="font-bold text-xl text-orange-600 mt-2">TOTAL: Bs. ${totalPrice.toFixed(2)}</li>`;
            
            orderModal.showModal();
        });

        // Cancelar el pedido
        cancelOrderBtn.addEventListener('click', () => {
            orderModal.close();
        });
        
        // Cerrar el modal de advertencia
        closeWarningBtn.addEventListener('click', () => {
            warningModal.close();
        });

        // Confirmar el pedido
        confirmOrderBtn.addEventListener('click', () => {
            const customerName = customerNameInput.value.trim();

            if (customerName === "") {
                nameErrorElement.classList.remove('hidden');
                return;
            }
            nameErrorElement.classList.add('hidden');
            
            orderModal.close();
            generateFinalSummary(customerName); // Generar el resumen final antes de mostrar el modal
            finalModal.showModal();
            
            resetOrder();
        });
        
        // Cerrar el modal final y permitir un nuevo pedido
        closeFinalBtn.addEventListener('click', () => {
            finalModal.close();
        });
        
        // Inicializar el total y la primera pestaña
        updateTotal();
        document.getElementById('drinks-tab').classList.add('active', 'bg-orange-600', 'text-white', 'shadow-lg');
        document.getElementById('drinks-panel').classList.remove('hidden');

        // ...existing code...
document.getElementById('download-summary-btn').addEventListener('click', () => {
    // Captura el contenedor completo, incluyendo encabezado y mensaje final
    const summaryContainer = document.getElementById('summary-capture-container');
    if (summaryContainer && summaryContainer.textContent.trim() !== "") {
        html2canvas(summaryContainer, {
            backgroundColor: '#fff',
            scale: 2 // Mejor calidad en móviles
        }).then(canvas => {
            canvas.toBlob(function(blob) {
                if (blob) {
                    const link = document.createElement('a');
                    link.download = 'pedido_pizzeria.png';
                    link.href = URL.createObjectURL(blob);
                    link.click();
                    URL.revokeObjectURL(link.href);
                } else {
                    alert('No se pudo generar la imagen. Intenta nuevamente.');
                }
            }, 'image/png');
        });
    } else {
        alert('El resumen está vacío. No se puede generar la imagen.');
    }
});

    </script>
</body>
</html>
